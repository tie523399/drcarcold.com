generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id            String    @id @default(cuid())
  email         String    @unique
  password      String
  name          String?
  role          String    @default("ADMIN")
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  
  // 關聯新聞文章
  editedNews    News[]
}

model Product {
  id            String    @id @default(cuid())
  name          String
  slug          String    @unique
  description   String
  details       String?   // 商品詳情
  category      Category  @relation(fields: [categoryId], references: [id])
  categoryId    String
  price         Float?
  images        String    @default("[]")
  features      String    @default("[]")
  specifications String   @default("{}")
  stock         Int       @default(0)
  isActive      Boolean   @default(true)
  seoTitle      String?
  seoDescription String?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  @@index([slug])
  @@index([categoryId])
}

model Category {
  id          String    @id @default(cuid())
  name        String
  slug        String    @unique
  description String?
  image       String?
  seoTitle    String?   // SEO 標題
  seoDescription String? // SEO 描述
  seoKeywords String?   // SEO 關鍵字
  products    Product[]
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
}

model Refrigerant {
  id            String    @id @default(cuid())
  name          String
  code          String    @unique
  type          String
  gwp           Float
  odp           Float
  boilingPoint  Float
  criticalTemp  Float
  properties    String    @default("{}")
  applications  String    @default("[]")
  safety        String    @default("{}")
  isActive      Boolean   @default(true)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  @@index([code])
}

model News {
  id            String    @id @default(cuid())
  title         String
  slug          String    @unique
  content       String
  excerpt       String
  coverImage    String?
  author        String
  tags          String    @default("[]")
  viewCount     Int       @default(0)
  publishedAt   DateTime?
  scheduledAt   DateTime?
  isPublished   Boolean   @default(false)
  
  // 新增欄位
  priority      String    @default("medium")  // high, medium, low
  category      String    @default("general") // technical, product, industry, general
  status        String    @default("draft")   // draft, review, published, archived
  isFeatured    Boolean   @default(false)     // 是否為特色文章
  language      String    @default("zh")      // zh, en
  editorId      String?                       // 編輯者 ID（關聯到 User）
  metadata      String    @default("{}")      // 額外元數據 (JSON)
  
  // SEO 相關欄位
  seoTitle      String?
  seoDescription String?
  seoKeywords   String?   // SEO 關鍵字
  canonicalUrl  String?   // 標準網址
  ogTitle       String?   // Open Graph 標題
  ogDescription String?   // Open Graph 描述
  ogImage       String?   // Open Graph 圖片
  structuredData String?  // JSON-LD 結構化資料
  readingTime   Int?      // 閱讀時間（分鐘）
  
  // 來源相關欄位
  sourceUrl     String?   // 原始文章連結
  sourceName    String?   // 來源網站名稱
  sourceId      String?   // 新聞來源 ID
  contentHash   String?   // 內容哈希值，用於去重
  relatedNews   String?   // 相關新聞 ID 列表 (JSON)
  
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  // 關聯編輯者
  editor        User?     @relation(fields: [editorId], references: [id])

  @@index([slug])
  @@index([publishedAt])
  @@index([tags])
  @@index([sourceName])
  @@index([sourceId])
  @@index([contentHash])
  @@index([priority])
  @@index([category])
  @@index([status])
  @@index([language])
  @@index([isFeatured])
}

model Setting {
  id        String   @id @default(cuid())
  key       String   @unique
  value     String
  updatedAt DateTime @updatedAt
}

model SeoRanking {
  id        String   @id @default(cuid())
  keyword   String
  position  Int?
  url       String?
  title     String?
  found     Boolean  @default(false)
  error     String?
  domain    String
  checkedAt DateTime @default(now())
  
  @@index([keyword, domain])
  @@index([checkedAt])
  @@map("seo_rankings")
}

model VehicleBrand {
  id          String    @id @default(cuid())
  name        String
  nameEn      String
  category    String    // "regular", "truck", "malaysia"
  order       Int       @default(0)
  models      VehicleModel[]
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  @@index([category])
}

model VehicleModel {
  id              String       @id @default(cuid())
  brandId         String
  brand           VehicleBrand @relation(fields: [brandId], references: [id], onDelete: Cascade)
  
  // 車輛基本資訊 (中文版)
  modelName       String       // 車型名稱 (如: 320i, X3, ACCORD)
  year            String?      // 年份範圍 (如: 2019-2023)
  engine          String?      // 引擎規格 (如: 2.0L 渦輪, 1.5T/2.0L)
  category        String?      // 車輛類別 (如: 馬來西亞車, 豪華轎車, SUV型)
  
  // 車輛基本資訊 (英文版)
  modelNameEn     String?      // 英文車型名稱 (如: 320i, X3, ACCORD)
  engineEn        String?      // 英文引擎規格 (如: 2.0L Turbo, 1.5T/2.0L)
  categoryEn      String?      // 英文車輛類別 (如: Malaysia Cars, Luxury Sedan, SUV)
  
  // 冷媒相關資訊
  refrigerantType String       // 冷媒類型 (如: R-1234yf, R134a)
  refrigerantAmount String     // 冷媒充填量 (如: 750g, 480±25g)
  
  // 冷凍油相關資訊
  oilType         String?      // 油品類型 (如: PAG 100, PAG 46, ND-OIL 8)
  oilAmount       String?      // 油品用量 (如: 180ml, 130±10ml)
  
  // 額外資訊 (中英文)
  notes           String?      // 中文備註 (如: 豪華轎車, 純電動車, 新款採用環保冷媒)
  notesEn         String?      // 英文備註 (如: Luxury Sedan, Electric Vehicle, New eco-friendly refrigerant)
  
  // 資料來源標識
  dataSource      String?      // 資料來源 (如: 中文版, 英文版, 馬來西亞版)
  
  createdAt       DateTime     @default(now())
  updatedAt       DateTime     @updatedAt

  @@index([brandId])
  @@index([modelName])
  @@index([modelNameEn])
  @@index([refrigerantType])
  @@index([year])
  @@index([category])
  @@index([dataSource])
}

model Banner {
  id          String    @id @default(cuid())
  title       String
  description String?
  image       String
  thumbnail   String?
  link        String?
  position    String    @default("homepage") // homepage, products, about
  order       Int       @default(0)
  isActive    Boolean   @default(true)
  mediaType   String    @default("image") // image, video, gif
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  @@index([position])
  @@index([order])
}

model NewsSource {
  id                 String    @id @default(cuid())
  name               String
  url                String
  rssUrl             String?
  enabled            Boolean   @default(true)
  maxArticlesPerCrawl Int      @default(5)
  crawlInterval      Int       @default(60) // 分鐘
  lastCrawl          DateTime?
  selectors          String?   // JSON 格式的選擇器配置
  createdAt          DateTime  @default(now())
  updatedAt          DateTime  @updatedAt

  @@index([enabled])
}

// 公司基本資訊
model CompanyInfo {
  id              String    @id @default(cuid())
  companyName     String    @default("車冷博士")
  companyNameEn   String    @default("Dr. Car Cold")
  
  // 基本聯絡資訊
  phone           String    @default("04-26301915")
  emergencyPhone  String?   // 24小時緊急專線
  fax             String?
  email           String    @default("hongshun.TW@gmail.com")
  lineId          String?   // Line官方帳號
  lineUrl         String?   // Line連結
  
  // 地址資訊
  address         String    @default("台中市龍井區臨港東路二段100號")
  addressEn       String?
  latitude        Float?    // 緯度
  longitude       Float?    // 經度
  
  // 營業時間
  businessHours   String    @default("週一至週五 8:30-17:30")
  businessHoursEn String?
  emergencyService String   @default("24小時緊急服務")
  
  // 服務區域 (JSON格式)
  serviceAreas    String?   // JSON: [{"name":"台北市","coverage":"100%","response":"30分鐘"}]
  
  // 社交媒體
  facebook        String?
  instagram       String?
  youtube         String?
  
  // 公司資訊
  description     String?   // 公司簡介
  descriptionEn   String?
  
  // 網站設定
  website         String    @default("https://drcarcold.com")
  
  updatedAt       DateTime  @updatedAt
}

// 首頁功能特點
model Feature {
  id            String    @id @default(cuid())
  icon          String    // 圖標名稱
  title         String
  titleEn       String
  description   String
  descriptionEn String
  order         Int       @default(0)
  isActive      Boolean   @default(true)
  position      String    @default("homepage") // homepage, about, etc.
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  @@index([position])
  @@index([order])
}

// 公司里程碑
model Milestone {
  id            String    @id @default(cuid())
  year          String
  event         String
  eventEn       String
  description   String?
  descriptionEn String?
  order         Int       @default(0)
  isActive      Boolean   @default(true)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  @@index([year])
  @@index([order])
}

// SEO 內容管理
model SeoContent {
  id              String    @id @default(cuid())
  page            String    @unique // products, about, home, etc.
  title           String
  titleEn         String
  description     String
  descriptionEn   String
  keywords        String    // 逗號分隔的關鍵字
  keywordsEn      String
  content         String?   // 頁面 SEO 內容
  contentEn       String?
  ogTitle         String?   // Open Graph 標題
  ogDescription   String?
  ogImage         String?
  structuredData  String?   // JSON-LD 結構化資料
  updatedAt       DateTime  @updatedAt

  @@index([page])
}

// 爬取日誌
model CrawlLog {
  id                String    @id @default(cuid())
  sourceId          String
  sourceName        String
  startTime         DateTime
  endTime           DateTime
  duration          Int       // 秒
  articlesFound     Int
  articlesProcessed Int
  articlesPublished Int
  articlesFailed    Int       @default(0)
  errors            String?   // JSON 格式的錯誤陣列
  success           Boolean
  createdAt         DateTime  @default(now())

  @@index([sourceId])
  @@index([createdAt])
  @@index([success])
}

model Contact {
  id            String    @id @default(cuid())
  name          String
  email         String
  phone         String?
  company       String?
  subject       String
  message       String
  customerType  String?   // 客戶類型：個人、公司、經銷商等
  interestedProducts String? // 感興趣的產品
  source        String    @default("website") // 來源：website, phone, email等
  status        String    @default("new") // 狀態：new, contacted, quoted, closed
  priority      String    @default("normal") // 優先級：low, normal, high, urgent
  assignedTo    String?   // 分配給哪位員工處理
  notes         String?   // 內部備註
  followUpDate  DateTime? // 跟進日期
  lastContactDate DateTime? // 最後聯絡日期
  isRead        Boolean   @default(false) // 是否已讀
  isReplied     Boolean   @default(false) // 是否已回覆
  tags          String    @default("[]") // 標籤，JSON格式
  ipAddress     String?   // 提交者IP
  userAgent     String?   // 瀏覽器信息
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  @@index([status])
  @@index([priority])
  @@index([isRead])
  @@index([createdAt])
  @@index([source])
}

// 舊的 Vehicle 模型已廢棄，請使用 VehicleBrand + VehicleModel 架構
// 此模型將在下次遷移時移除